<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Teacher Shirley | Moon Base</title>

  <!-- Fonts (keep original vibe) -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Exo+2:wght@300;400;600;700;800&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Noto+Serif+TC:wght@400;600;700;900&family=Dancing+Script:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0b0f19;
      --surface: rgba(255,255,255,0.06);
      --surface-strong: rgba(255,255,255,0.12);
      --border: rgba(255,255,255,0.12);
      --text: #e9eef7;
      --text-light: rgba(233,238,247,0.65);
      --accent: #7fd6ff;
      --accent-2: #ffd36b;
      --card-shadow: 0 10px 35px rgba(0,0,0,0.45);
    }

    *{box-sizing:border-box;}
    body{
      margin:0; font-family:'Exo 2',system-ui,-apple-system;
      background: radial-gradient(1200px 700px at 70% -10%, #112c4a 0%, transparent 60%),
                  radial-gradient(800px 500px at 10% 0%, #2a174a 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    /* ----- Layout / Sections (keep original structure but simplified) ----- */
    #intro-overlay{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.9); z-index:1000; flex-direction:column; gap:1rem;
    }
    #intro-overlay h1{font-family:'Cinzel Decorative'; letter-spacing:2px;}
    .primary-btn{
      background:var(--accent); color:#001528; padding:.8rem 1.2rem; border:none; border-radius:12px;
      font-weight:800; cursor:pointer; box-shadow:var(--card-shadow);
    }

    #universe-view, #visitor-view{display:none; opacity:0; transition:opacity .5s ease;}
    #universe-view.active, #visitor-view.active{display:block; opacity:1;}

    header{
      padding:1.5rem 2rem; display:flex; align-items:center; justify-content:space-between;
      position:sticky; top:0; backdrop-filter:blur(8px); background:rgba(5,8,14,0.6); z-index:50;
      border-bottom:1px solid var(--border);
    }
    header .logo{font-family:'Cinzel Decorative'; font-weight:900; letter-spacing:2px;}
    header .right{display:flex; gap:.75rem; align-items:center;}
    #logoutBtn{display:none;}

    .categories{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));
      gap:1.5rem; padding:2rem; max-width:1100px; margin:0 auto;
    }
    .category-card{
      background:var(--surface); border:1px solid var(--border); border-radius:18px; padding:2rem 1.5rem;
      text-decoration:none; color:var(--text); display:flex; flex-direction:column; align-items:center; gap:.5rem;
      transition:.3s; box-shadow:var(--card-shadow);
    }
    .category-card:hover{transform:translateY(-6px); border-color:var(--accent);}
    .icon{font-size:2.5rem;}

    /* ----- Member Terminal / Dashboard ----- */
    #member-terminal{
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(.95);
      width:92%; max-width:980px; max-height:86vh; overflow:auto; z-index:2000;
      background:rgba(9,12,20,0.96); border:1px solid var(--border); border-radius:22px; padding:2rem;
      box-shadow:0 25px 80px rgba(0,0,0,0.55); display:none; opacity:0; transition:.25s;
      backdrop-filter: blur(10px);
    }
    #member-terminal.show{display:block; opacity:1; transform:translate(-50%,-50%) scale(1);}
    .close-terminal{position:absolute; top:16px; right:18px; font-size:1.5rem; cursor:pointer;}

    .member-dashboard{
      display:grid; grid-template-columns:280px 1fr; gap:1.5rem; margin-top:1rem;
    }
    @media (max-width: 860px){ .member-dashboard{grid-template-columns:1fr;} }

    .profile-panel{
      background:rgba(255,255,255,0.03); border-radius:16px; padding:1.5rem; text-align:center;
      border:1px solid var(--border);
    }
    .streak-ring{
      width:110px; height:110px; border:5px solid var(--accent); border-radius:50%;
      margin:0 auto 1rem; display:flex; align-items:center; justify-content:center; flex-direction:column;
    }
    .streak-num{font-size:2.4rem; font-weight:900; color:var(--accent);}
    .data-card{background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:1.25rem;}
    .word-card{border-left:5px solid #3498db;}
    .quote-card{border-left:5px solid #f1c40f; margin-top:1rem;}

    .checkin-btn{
      width:100%; padding:14px; background:var(--accent); color:white; border:none; border-radius:10px;
      font-weight:800; cursor:pointer; margin-top:12px;
    }
    .checkin-btn:disabled{background:#7c8a96; cursor:not-allowed;}

    .calendar-wrap{margin-top:1rem;}
    .calendar-header{
      display:flex; align-items:center; justify-content:space-between; margin-bottom:.5rem;
    }
    .calendar-header button{
      background:var(--surface-strong); color:var(--text); border:1px solid var(--border);
      padding:.4rem .7rem; border-radius:8px; cursor:pointer;
    }
    .calendar-grid{
      display:grid; grid-template-columns:repeat(7,1fr); gap:4px; font-size:.8rem;
    }
    .calendar-day{
      padding:.6rem .2rem; text-align:center; border-radius:8px; border:1px solid transparent;
      background:rgba(255,255,255,0.03);
    }
    .calendar-day.today{border-color:var(--accent); font-weight:800;}
    .calendar-day-checked{
      border-color:var(--accent-2); font-weight:800; cursor:pointer; position:relative; overflow:hidden;
      background:rgba(255,211,107,0.12);
    }
    .calendar-day-checked:hover::after{
      content:'ğŸƒ'; position:absolute; inset:0; background:rgba(0,0,0,0.35);
      display:flex; align-items:center; justify-content:center; font-size:1.2rem;
    }

    /* ----- Card Pocket / Bag (by month) ----- */
    .pocket-section{margin-top:1rem;}
    .pocket-title{
      font-family:'Cinzel Decorative'; font-weight:800; letter-spacing:1px;
      display:flex; align-items:center; gap:.5rem; margin:0 0 .75rem 0;
    }
    .pocket-month{
      border:1px solid var(--border); background:rgba(255,255,255,0.03);
      border-radius:14px; padding:1rem; margin-bottom:1rem;
    }
    .pocket-month h4{
      margin:.25rem 0 .75rem 0; font-weight:800; color:var(--accent-2);
      letter-spacing:.5px;
    }
    .pocket-grid{
      display:grid; grid-template-columns:repeat(auto-fill, minmax(120px, 1fr)); gap:.75rem;
    }
    .pocket-item{
      background:rgba(0,0,0,0.35); border:1px solid var(--border); border-radius:12px;
      padding:.5rem; cursor:pointer; transition:.2s; display:flex; flex-direction:column; gap:.25rem;
    }
    .pocket-item:hover{transform:translateY(-3px); border-color:var(--accent);}
    .thumb{
      aspect-ratio: 7/10; border-radius:8px; border:1px solid rgba(255,255,255,0.15);
      display:flex; align-items:center; justify-content:center; font-weight:900; font-size:1.6rem;
      color:white; position:relative; overflow:hidden;
      background:var(--card-bg, #111);
    }
    .thumb .thumb-glow{
      position:absolute; inset:-30%; background:radial-gradient(circle, rgba(255,255,255,0.25), transparent 60%);
      filter: blur(18px);
    }
    .thumb .thumb-day{
      position:relative; z-index:2; text-shadow:0 2px 6px rgba(0,0,0,0.8);
    }
    .pocket-date{
      font-size:.75rem; color:var(--text-light); text-align:center;
    }

    /* ----- Card Modal ----- */
    #card-modal{
      position:fixed; inset:0; background:rgba(0,0,0,0.78); z-index:5000;
      display:none; align-items:center; justify-content:center; padding:1rem;
      backdrop-filter: blur(4px);
    }
    #card-modal.active{display:flex;}

    .card-modal-content{width:100%; max-width:520px;}

    .collectible-card{
      position:relative; width:100%; aspect-ratio: 7/10; border-radius:20px;
      padding:22px 20px 18px; border:2px solid var(--card-border,#aaa);
      background:var(--card-bg, linear-gradient(180deg,#111,#333));
      box-shadow:0 20px 60px rgba(0,0,0,0.6); overflow:hidden; display:flex; flex-direction:column;
      color:var(--card-text,#eee);
      text-shadow:0 1px 2px rgba(0,0,0,0.65); /* ä¿åº•å¯è®€æ€§ */
    }
    .collectible-card.light-theme{
      color:#111; text-shadow:0 1px 1px rgba(255,255,255,0.35);
    }

    .card-header{
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
      font-family:'Cinzel Decorative';
    }
    .card-user{font-weight:900; font-size:1.2rem;}
    .card-date{font-size:.95rem; opacity:.9;}
    .card-serial{font-size:.8rem; opacity:.7; font-weight:700;}

    .card-body{margin-top:12px; display:flex; flex-direction:column; gap:10px; flex:1;}

    .card-wotd{
      font-size:1.6rem; font-weight:900; letter-spacing:.5px;
      font-family:'Playfair Display';
    }
    .card-pos{font-size:.95rem; opacity:.9;}
    .card-def{
      font-size:1rem; line-height:1.5; color:var(--card-text-dim,#ccc);
      font-family:'Noto Serif TC';
    }

    .card-sentence-container{
      margin-top:8px; padding-top:8px; border-top:1px dashed var(--card-accent-dim, rgba(255,255,255,0.1));
    }
    .card-sent-en{
      font-family:'Exo 2'; font-style:italic; font-size:.95rem; color:var(--card-text-dim,#ccc);
      line-height:1.35; font-weight:600;
    }
    .card-sent-cn{
      font-family:'Noto Serif TC'; font-size:.9rem; color:var(--card-text-dim,#aaa); opacity:.95;
      line-height:1.35;
    }

    .card-quote-box{
      position:relative; padding:12px; border-left:3px solid var(--card-accent, #ffd700);
      background:linear-gradient(90deg, var(--card-accent-dim, rgba(255,255,255,0.05)), transparent);
      margin-top:auto;
    }
    .card-quote-text{font-family:'Playfair Display'; font-style:italic; font-size:1.02rem; line-height:1.55;}
    .card-quote-trans{
      font-family:'Noto Serif TC'; font-size:.95rem; color:var(--card-text-dim,#ddd); margin-top:6px;
    }
    .card-quote-author{
      text-align:right; font-size:.85rem; font-weight:900; margin-top:6px; color:var(--card-accent,#ffd700);
    }

    .card-footer{
      margin-top:14px; padding-top:10px; border-top:1px solid var(--card-accent-dim, rgba(255,255,255,0.15));
      display:flex; justify-content:space-between; align-items:center;
    }
    .card-streak-badge{
      background:var(--card-accent,#ffd700); color:var(--card-bg,#000); padding:5px 12px; border-radius:20px;
      font-size:.85rem; font-weight:900; display:flex; align-items:center; gap:6px;
      box-shadow:0 0 10px var(--card-accent-dim, rgba(255,215,0,0.35));
    }
    .card-signature{
      font-family:'Dancing Script'; font-size:1.5rem; color:var(--card-text-dim,#bbb);
      transform:rotate(-5deg);
    }

    .card-watermark{
      position:absolute; bottom:8px; right:16px; font-size:4rem; font-weight:900;
      color:rgba(255,255,255,0.03); pointer-events:none; font-family:'Cinzel Decorative';
      white-space:nowrap;
    }
    .card-shine{
      position:absolute; inset:0; background:linear-gradient(125deg, transparent 40%, rgba(255,255,255,0.06) 45%, transparent 50%);
      pointer-events:none;
    }

    .card-actions{display:flex; gap:12px; margin-top:12px; justify-content:center;}
    .btn-card-action{
      padding:9px 18px; border-radius:25px; border:none; font-weight:900; cursor:pointer;
      font-family:'Exo 2'; font-size:.95rem; display:flex; align-items:center; gap:6px; transition:.2s;
    }
    .btn-download{
      background:linear-gradient(90deg,#b8860b,#f1c40f); color:#1b2430;
      box-shadow:0 4px 15px rgba(241,196,15,0.25);
    }
    .btn-close{
      background:rgba(255,255,255,0.2); color:white; border:1px solid rgba(255,255,255,0.25);
    }
    .btn-card-action:hover{transform:translateY(-2px); filter:brightness(1.06);}

    /* =====================
       88 Themes (from your file)
       é€™è£¡ä¿ç•™ä½ åŸæœ¬ theme-1 ~ theme-88
       æˆ‘åªåœ¨å°‘æ•¸äº®è‰²ç³»ä¸Šå¾®èª¿ card-text / dim ä»¥æå‡å¯è®€æ€§
       ===================== */

    /* 1. Midnight Gold */
    .theme-1 { --card-bg: linear-gradient(180deg, #0f2027, #203a43, #2c5364); --card-border: #b8860b; --card-accent: #ffd700; --card-highlight: #fff; --card-text: #e0e0e0; --card-text-dim: #c9d4e1; --card-accent-dim: rgba(184, 134, 11, 0.25); }
    /* 2. Royal Navy */
    .theme-2 { --card-bg: linear-gradient(180deg, #001f3f, #003366); --card-border: #7fdbff; --card-accent: #7fdbff; --card-highlight: #fff; --card-text: #f5faff; --card-text-dim: #cfefff; --card-accent-dim: rgba(127, 219, 255, 0.2); }
    /* 3. Emerald Dawn */
    .theme-3 { --card-bg: linear-gradient(180deg, #0b3d2e, #145a32); --card-border: #2ecc71; --card-accent: #2ecc71; --card-highlight: #fff; --card-text: #eafff1; --card-text-dim: #c8f7dc; --card-accent-dim: rgba(46, 204, 113, 0.2); }
    /* 4. Crimson Velvet */
    .theme-4 { --card-bg: linear-gradient(180deg, #3a001e, #6a0037); --card-border: #ff6b8a; --card-accent: #ff6b8a; --card-highlight: #fff; --card-text: #ffeef2; --card-text-dim: #ffd2de; --card-accent-dim: rgba(255, 107, 138, 0.2); }
    /* 5. Silver Mist */
    .theme-5 { --card-bg: linear-gradient(180deg, #bdc3c7, #2c3e50); --card-border: #ecf0f1; --card-accent: #ecf0f1; --card-highlight: #fff; --card-text: #0b0f14; --card-text-dim: #1c2732; --card-accent-dim: rgba(236, 240, 241, 0.25); }
    /* 6. Celestial Purple */
    .theme-6 { --card-bg: linear-gradient(180deg, #2b1055, #7597de); --card-border: #c8a2ff; --card-accent: #c8a2ff; --card-highlight: #fff; --card-text: #f7f2ff; --card-text-dim: #e3d5ff; --card-accent-dim: rgba(200, 162, 255, 0.2); }
    /* 7. Sunlit Sand */
    .theme-7 { --card-bg: linear-gradient(180deg, #f7d794, #f3a683); --card-border: #fff; --card-accent: #7d4e2d; --card-highlight: #fff; --card-text: #29180e; --card-text-dim: #3b2418; --card-accent-dim: rgba(255,255,255,0.35); }
    /* 8. Glacier Blue */
    .theme-8 { --card-bg: linear-gradient(180deg, #dff9fb, #c7ecee); --card-border: #22a6b3; --card-accent: #22a6b3; --card-highlight: #fff; --card-text: #0b1a1b; --card-text-dim: #1c2f31; --card-accent-dim: rgba(34,166,179,0.2); }
    /* 9. Peach Blossom */
    .theme-9 { --card-bg: linear-gradient(180deg, #ffb8b8, #ffd6a5); --card-border: #fff; --card-accent: #b23a48; --card-highlight: #fff; --card-text: #2d0d10; --card-text-dim: #482126; --card-accent-dim: rgba(255,255,255,0.35); }
    /* 10. Space Grey */
    .theme-10 { --card-bg: linear-gradient(180deg, #232526, #414345); --card-border: #95a5a6; --card-accent: #95a5a6; --card-highlight: #fff; --card-text: #ecf0f1; --card-text-dim: #c8d0d2; --card-accent-dim: rgba(149,165,166,0.2); }
    /* 11. Cyber Moon */
    .theme-11 { --card-bg: linear-gradient(45deg, #111, #222); --card-border: #0ff; --card-accent: #0ff; --card-highlight: #fff; --card-text: #eee; --card-text-dim: #bfe; --card-accent-dim: rgba(0, 255, 255, 0.2); border-width: 1px; box-shadow: 0 0 15px rgba(0,255,255,0.2); }

    /*  /* 12. Ocean Depth (æ·±æµ·) */
    .theme-12 { --card-bg: linear-gradient(180deg, #1cb5e0 0%, #000851 100%); --card-border: #89f7fe; --card-accent: #66a6ff; --card-highlight: #fff; --card-text: #e2f0f9; --card-text-dim: #89f7fe; --card-accent-dim: rgba(137, 247, 254, 0.2); }
    /* 13. Mint Leaf (è–„è·) */
    .theme-13 { --card-bg: linear-gradient(45deg, #81fbb8 0%, #28c76f 100%); --card-border: #fff; --card-accent: #0f4c2e; --card-highlight: #e0ffd4; --card-text: #082015; --card-text-dim: #1e5c3e; --card-accent-dim: rgba(255,255,255,0.3); }
    /* 14. Sweet Candy (ç³–æœ) */
    .theme-14 { --card-bg: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); --card-border: #ff6f91; --card-accent: #ff80bf; --card-highlight: #fff; --card-text: #5e2c3a; --card-text-dim: #965f70; --card-accent-dim: rgba(255, 111, 145, 0.2); }
    /* 15. Royal Purple (çš‡å®¤) */
    .theme-15 { --card-bg: linear-gradient(to right, #654ea3, #eaafc8); --card-border: #ffd700; --card-accent: #ffd700; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #e0c3fc; --card-accent-dim: rgba(255, 215, 0, 0.2); }
    /* 16. Volcano (ç«å±±) */
    .theme-16 { --card-bg: linear-gradient(to top, #ff0844 0%, #ffb199 100%); --card-border: #520000; --card-accent: #8b0000; --card-highlight: #fff; --card-text: #520000; --card-text-dim: #941818; --card-accent-dim: rgba(82, 0, 0, 0.1); }
    /* 17. Cyberpunk (è³½åš) */
    .theme-17 { --card-bg: linear-gradient(180deg, #0f0c29, #302b63, #24243e); --card-border: #00f260; --card-accent: #0575e6; --card-highlight: #00f260; --card-text: #00f260; --card-text-dim: #0575e6; --card-accent-dim: rgba(0, 242, 96, 0.15); }
    /* 18. Coffee Time (å’–å•¡) */
    .theme-18 { --card-bg: linear-gradient(to right, #d7d2cc 0%, #304352 100%); --card-border: #5d4037; --card-accent: #8d6e63; --card-highlight: #3e2723; --card-text: #1a1a1a; --card-text-dim: #4e342e; --card-accent-dim: rgba(93, 64, 55, 0.1); }
    /* 19. Forest Night (æ£®å¤œ) */
    .theme-19 { --card-bg: linear-gradient(to bottom, #093028, #237a57); --card-border: #43cca1; --card-accent: #43cca1; --card-highlight: #fff; --card-text: #d4fc79; --card-text-dim: #96e6a1; --card-accent-dim: rgba(67, 204, 161, 0.2); }
    /* 20. Lemonade (æª¸æª¬) */
    .theme-20 { --card-bg: linear-gradient(120deg, #f6d365 0%, #fda085 100%); --card-border: #fff; --card-accent: #d35400; --card-highlight: #fff; --card-text: #d35400; --card-text-dim: #e67e22; --card-accent-dim: rgba(255,255,255,0.4); }
    /* 21. Steel Grey (é‹¼éµ) */
    .theme-21 { --card-bg: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); --card-border: #7f8c8d; --card-accent: #2c3e50; --card-highlight: #bdc3c7; --card-text: #2c3e50; --card-text-dim: #7f8c8d; --card-accent-dim: rgba(44, 62, 80, 0.1); }
    /* 22. Rose Gold (ç«ç‘°é‡‘) */
    .theme-22 { --card-bg: linear-gradient(to right, #fff1eb 0%, #ace0f9 100%); --card-border: #b76e79; --card-accent: #b76e79; --card-highlight: #fff; --card-text: #5e3b42; --card-text-dim: #b76e79; --card-accent-dim: rgba(183, 110, 121, 0.2); }
    /* 23. Neon City (éœ“è™¹) */
    .theme-23 { --card-bg: #111; --card-border: #ff00de; --card-accent: #00ffea; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #ff00de; --card-accent-dim: rgba(255, 0, 222, 0.2); box-shadow: 0 0 15px rgba(255,0,222,0.4); }
    /* 24. Desert Sand (æ²™æ¼ ) */
    .theme-24 { --card-bg: linear-gradient(to bottom, #C06C84, #6C5B7B, #355C7D); --card-border: #F8B195; --card-accent: #F67280; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #F8B195; --card-accent-dim: rgba(248, 177, 149, 0.2); }
    /* 25. Frozen (å†°é›ª) */
    .theme-25 { --card-bg: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%); --card-border: #fff; --card-accent: #6a11cb; --card-highlight: #fff; --card-text: #4a00e0; --card-text-dim: #8e2de2; --card-accent-dim: rgba(255,255,255,0.5); }
    /* 26. Matcha (æŠ¹èŒ¶) */
    .theme-26 { --card-bg: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); --card-border: #2d6a4f; --card-accent: #1b4332; --card-highlight: #fff; --card-text: #081c15; --card-text-dim: #2d6a4f; --card-accent-dim: rgba(45, 106, 79, 0.2); }
    /* 27. Sunset (æ—¥è½) */
    .theme-27 { --card-bg: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%); --card-border: #ff6b6b; --card-accent: #ff6b6b; --card-highlight: #fff; --card-text: #c0392b; --card-text-dim: #e17055; --card-accent-dim: rgba(255, 107, 107, 0.2); }
    /* 28. Blackboard (é»‘æ¿) */
    .theme-28 { --card-bg: #2d3436; --card-border: #dfe6e9; --card-accent: #fd79a8; --card-highlight: #fff; --card-text: #dfe6e9; --card-text-dim: #b2bec3; --card-accent-dim: rgba(255,255,255,0.1); border-style: dashed; }
    /* 29. Ink Wash (æ°´å¢¨) */
    .theme-29 { --card-bg: linear-gradient(to bottom, #ffffff, #dcdcdc); --card-border: #000; --card-accent: #c0392b; --card-highlight: #000; --card-text: #000; --card-text-dim: #555; --card-accent-dim: rgba(0,0,0,0.1); }

   /* --- 30-39: ç å¯¶èˆ‡ç¤¦çŸ³ç³»åˆ— (Gemstones & Minerals) --- */
    
    /* 30. White Pearl (ç™½çç ) - æº«æ½¤å…‰æ¾¤ */
    .theme-30 { --card-bg: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); --card-border: #d7d7d7; --card-accent: #b0b0b0; --card-highlight: #fff; --card-text: #2c3e50; --card-text-dim: #7f8c8d; --card-accent-dim: rgba(0,0,0,0.05); }

    /* 31. Emerald City (ç¥–æ¯ç¶ ) - æ·±é‚ƒå°Šè²´ */
    .theme-31 { --card-bg: linear-gradient(to bottom right, #051937, #004d40); --card-border: #00897b; --card-accent: #26a69a; --card-highlight: #b2dfdb; --card-text: #e0f2f1; --card-text-dim: #80cbc4; --card-accent-dim: rgba(38, 166, 154, 0.2); }

    /* 32. Royal Amethyst (çš‡å®¶ç´«æ™¶) - ç¥ç§˜å¥¢è¯ */
    .theme-32 { --card-bg: radial-gradient(circle at top right, #360033, #0b8793); --card-border: #d1c4e9; --card-accent: #e1bee7; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #b39ddb; --card-accent-dim: rgba(225, 190, 231, 0.15); }

    /* 33. Sapphire Night (è—å¯¶çŸ³) - éœè¬æ·±è— */
    .theme-33 { --card-bg: linear-gradient(160deg, #002244, #001122); --card-border: #1565c0; --card-accent: #42a5f5; --card-highlight: #fff; --card-text: #e3f2fd; --card-text-dim: #90caf9; --card-accent-dim: rgba(66, 165, 245, 0.2); }

    /* 34. Ruby Wine (ç´…å¯¶çŸ³é…’ç´…) - é†‡åšè³ªæ„Ÿ */
    .theme-34 { --card-bg: linear-gradient(to bottom, #4a0000, #2b0000); --card-border: #b71c1c; --card-accent: #ff5252; --card-highlight: #ffcdd2; --card-text: #ffebee; --card-text-dim: #ef9a9a; --card-accent-dim: rgba(255, 82, 82, 0.2); }

    /* 35. Black Opal (é»‘è›‹ç™½çŸ³) - æš—å¤œæµå…‰ */
    .theme-35 { --card-bg: linear-gradient(45deg, #141e30, #243b55); --card-border: #00bcd4; --card-accent: #00e5ff; --card-highlight: #e0f7fa; --card-text: #eceff1; --card-text-dim: #607d8b; --card-accent-dim: rgba(0, 229, 255, 0.1); }

    /* 36. Amber Fossil (ç¥ç€) - å‡å›ºæ™‚å…‰ */
    .theme-36 { --card-bg: linear-gradient(to right, #b46105, #5e3100); --card-border: #ffca28; --card-accent: #ffd54f; --card-highlight: #fff8e1; --card-text: #fff; --card-text-dim: #ffecb3; --card-accent-dim: rgba(255, 213, 79, 0.2); }

    /* 37. Moonstone (æœˆå…‰çŸ³) - å¤¢å¹»è—æšˆ */
    .theme-37 { --card-bg: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); --card-border: #aab7b8; --card-accent: #78909c; --card-highlight: #fff; --card-text: #455a64; --card-text-dim: #90a4ae; --card-accent-dim: rgba(120, 144, 156, 0.1); }

    /* 38. Jade Dragon (å¢¨ç‰) - æ±æ–¹å¤å…¸ */
    .theme-38 { --card-bg: linear-gradient(to bottom, #1d2b25, #0f1612); --card-border: #69f0ae; --card-accent: #b9f6ca; --card-highlight: #fff; --card-text: #e8f5e9; --card-text-dim: #81c784; --card-accent-dim: rgba(105, 240, 174, 0.1); }

    /* 39. Bronze Age (é’éŠ…æ™‚ä»£) - å¾©å¤é‡‘å±¬ */
    .theme-39 { --card-bg: linear-gradient(to right, #4b3832, #2c1e18); --card-border: #cd7f32; --card-accent: #d7a877; --card-highlight: #fff; --card-text: #f5deb3; --card-text-dim: #a1887f; --card-accent-dim: rgba(205, 127, 50, 0.2); }

    /* --- 40-49: è‡ªç„¶èˆ‡æ°›åœç³»åˆ— (Nature & Atmosphere) --- */

    /* 40. Nordic Aurora (åŒ—æ­æ¥µå…‰) - å¹½å†·æ¥µç°¡ */
    .theme-40 { --card-bg: #1c2329; --card-border: #4a6fa5; --card-accent: #90caf9; --card-highlight: #e3f2fd; --card-text: #eceff1; --card-text-dim: #78909c; --card-accent-dim: rgba(144, 202, 249, 0.1); }

    /* 41. Deep Ocean (æ·±æµ·æ½›è¡Œ) - æ¼¸å±¤è—ç¶  */
    .theme-41 { --card-bg: linear-gradient(180deg, #1a2980 0%, #26d0ce 100%); --card-border: #81d4fa; --card-accent: #4dd0e1; --card-highlight: #e0f7fa; --card-text: #e1f5fe; --card-text-dim: #80deea; --card-accent-dim: rgba(77, 208, 225, 0.2); }

    /* 42. Sakura Rain (æ«»èŠ±é›¨) - æŸ”ç¾ç²‰å«© */
    .theme-42 { --card-bg: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%); --card-border: #ffab91; --card-accent: #ff8a65; --card-highlight: #fff; --card-text: #5d4037; --card-text-dim: #a1887f; --card-accent-dim: rgba(255, 138, 101, 0.2); }

    /* 43. Desert Gold (æµæ²™é‡‘) - æº«æš–è¼ç…Œ */
    .theme-43 { --card-bg: linear-gradient(to bottom, #C06C84, #6C5B7B, #355C7D); --card-border: #f8b195; --card-accent: #ffccbc; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #ffab91; --card-accent-dim: rgba(248, 177, 149, 0.2); }

    /* 44. Misty Forest (è¿·éœ§æ£®æ—) - ä½é£½å’Œç¶  */
    .theme-44 { --card-bg: linear-gradient(to top, #2C3E50, #4CA1AF); --card-border: #80cbc4; --card-accent: #b2dfdb; --card-highlight: #e0f2f1; --card-text: #e0f7fa; --card-text-dim: #80deea; --card-accent-dim: rgba(178, 223, 219, 0.1); }

    /* 45. Lavender Dream (è–°è¡£è‰å¤¢) - æ·¡é›…ç´« */
    .theme-45 { --card-bg: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%); --card-border: #9fa8da; --card-accent: #7986cb; --card-highlight: #fff; --card-text: #303f9f; --card-text-dim: #5c6bc0; --card-accent-dim: rgba(121, 134, 203, 0.2); }

    /* 46. Volcanic Ash (ç«å±±ç°) - å†·å†½è³ªæ„Ÿ */
    .theme-46 { --card-bg: linear-gradient(to right, #434343 0%, #000000 100%); --card-border: #757575; --card-accent: #bdbdbd; --card-highlight: #fff; --card-text: #f5f5f5; --card-text-dim: #9e9e9e; --card-accent-dim: rgba(255,255,255,0.1); }

    /* 47. Autumn Maple (ç§‹æ¥“) - æ¿ƒéƒæ©™ç´… */
    .theme-47 { --card-bg: linear-gradient(to right, #d31027, #ea384d); --card-border: #ff8a80; --card-accent: #ff5252; --card-highlight: #ffebee; --card-text: #fff; --card-text-dim: #ffcdd2; --card-accent-dim: rgba(255, 82, 82, 0.2); }

    /* 48. Glacial Ice (å†°æ²³) - é€šé€è—ç™½ */
    .theme-48 { --card-bg: linear-gradient(to top, #accbee 0%, #e7f0fd 100%); --card-border: #90caf9; --card-accent: #64b5f6; --card-highlight: #fff; --card-text: #1565c0; --card-text-dim: #64b5f6; --card-accent-dim: rgba(33, 150, 243, 0.1); }

    /* 49. Bamboo Zen (ç«¹ç¦ª) - æ¸…å¹½é›…è‡´ */
    .theme-49 { --card-bg: linear-gradient(135deg, #134e5e, #71b280); --card-border: #a5d6a7; --card-accent: #c8e6c9; --card-highlight: #e8f5e9; --card-text: #f1f8e9; --card-text-dim: #a5d6a7; --card-accent-dim: rgba(165, 214, 167, 0.2); }

    /* --- 50-59: é«˜ç´šæè³ªèˆ‡ç¾ä»£é¢¨ (Material & Modern) --- */

    /* 50. Champagne Gold (é¦™æª³é‡‘) - æ´¾å°å¥¢è¯ */
    .theme-50 { --card-bg: linear-gradient(to bottom, #eee4d6, #dccdb6); --card-border: #c5a065; --card-accent: #bfa068; --card-highlight: #fff; --card-text: #5d4037; --card-text-dim: #8d6e63; --card-accent-dim: rgba(197, 160, 101, 0.2); }

    /* 51. Carbon Fiber (ç¢³çº–ç¶­) - ç§‘æŠ€é‹å‹• */
    .theme-51 { --card-bg: repeating-linear-gradient(45deg, #111, #111 10px, #222 10px, #222 20px); --card-border: #333; --card-accent: #e74c3c; --card-highlight: #fff; --card-text: #eee; --card-text-dim: #777; --card-accent-dim: rgba(231, 76, 60, 0.3); }

    /* 52. Vintage Leather (è€çš®é©) - ç´³å£«æ£• */
    .theme-52 { --card-bg: linear-gradient(#3e2723, #281a16); --card-border: #8d6e63; --card-accent: #d7ccc8; --card-highlight: #efebe9; --card-text: #d7ccc8; --card-text-dim: #a1887f; --card-accent-dim: rgba(141, 110, 99, 0.2); }

    /* 53. Royal Velvet (çµ²çµ¨è—) - æŸ”è»Ÿæ·±æ²‰ */
    .theme-53 { --card-bg: linear-gradient(to bottom, #1a237e, #0d1245); --card-border: #7986cb; --card-accent: #c5cae9; --card-highlight: #fff; --card-text: #e8eaf6; --card-text-dim: #9fa8da; --card-accent-dim: rgba(197, 202, 233, 0.1); }

    /* 54. Rose Gold (ç«ç‘°é‡‘ç®”) - æ™‚å°šé‡‘å±¬ */
    .theme-54 { --card-bg: linear-gradient(135deg, #e6b9b8, #c68a88); --card-border: #fff; --card-accent: #8e5856; --card-highlight: #fff0f0; --card-text: #4e342e; --card-text-dim: #8d6e63; --card-accent-dim: rgba(255, 255, 255, 0.4); }

    /* 55. Polished Steel (æ‹‹å…‰é‹¼) - å·¥æ¥­å†·èª¿ */
    .theme-55 { --card-bg: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%); --card-border: #757575; --card-accent: #616161; --card-highlight: #fff; --card-text: #212121; --card-text-dim: #616161; --card-accent-dim: rgba(0,0,0,0.1); }

    /* 56. Matte Black (æ¶ˆå…‰é»‘) - æ¥µè‡´ä½èª¿ */
    .theme-56 { --card-bg: #121212; --card-border: #2c2c2c; --card-accent: #666; --card-highlight: #444; --card-text: #bbb; --card-text-dim: #444; --card-accent-dim: rgba(255,255,255,0.05); }

    /* 57. Neon Noir (éœ“è™¹é»‘å¤œ) - è³½åšé¾å…‹ */
    .theme-57 { --card-bg: linear-gradient(to bottom, #000428, #004e92); --card-border: #d500f9; --card-accent: #00e5ff; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #d500f9; --card-accent-dim: rgba(213, 0, 249, 0.2); }

    /* 58. Ivory Tower (è±¡ç‰™ç™½) - ç´”æ·¨å…¸é›… */
    .theme-58 { --card-bg: linear-gradient(to bottom, #fffff0, #f0f0e0); --card-border: #dcdcdc; --card-accent: #a9a9a9; --card-highlight: #fff; --card-text: #333; --card-text-dim: #888; --card-accent-dim: rgba(0,0,0,0.03); }

    /* 59. Gunmetal (æ§ç°è‰²) - ç¡¬æ´¾è»äº‹ */
    .theme-59 { --card-bg: linear-gradient(180deg, #232526 0%, #414345 100%); --card-border: #585858; --card-accent: #d32f2f; --card-highlight: #757575; --card-text: #e0e0e0; --card-text-dim: #616161; --card-accent-dim: rgba(211, 47, 47, 0.2); }

    /* --- 60-69: è—è¡“èˆ‡äººæ–‡ç³»åˆ— (Arts & Culture) --- */

    /* 60. Ink Wash Painting (æ°´å¢¨å±±æ°´) - é»‘ç™½å±¤æ¬¡ */
    .theme-60 { --card-bg: linear-gradient(to bottom, #f5f5f5, #cfd9df); --card-border: #212121; --card-accent: #424242; --card-highlight: #000; --card-text: #000; --card-text-dim: #616161; --card-accent-dim: rgba(0,0,0,0.1); }

    /* 61. Porcelain Blue (é’èŠ±ç“·) - è—ç™½ç›¸é–“ */
    .theme-61 { --card-bg: #fff; --card-border: #1565c0; --card-accent: #0d47a1; --card-highlight: #e3f2fd; --card-text: #0d47a1; --card-text-dim: #64b5f6; --card-accent-dim: rgba(13, 71, 161, 0.1); border: 2px solid #1565c0; }

    /* 62. Old Parchment (èˆŠç¾Šçš®ç´™) - æ­·å²æ„Ÿ */
    .theme-62 { --card-bg: linear-gradient(to bottom, #fdfbfb, #ebedee); background-color: #f3e5f5; --card-bg: #fff8e1; --card-border: #d7ccc8; --card-accent: #8d6e63; --card-highlight: #fff; --card-text: #5d4037; --card-text-dim: #a1887f; --card-accent-dim: rgba(141, 110, 99, 0.1); }

    /* 63. Renaissance (æ–‡è—å¾©èˆˆ) - æ²¹ç•«è³ªæ„Ÿ */
    .theme-63 { --card-bg: linear-gradient(to right, #3e5151, #decba4); --card-border: #8d6e63; --card-accent: #d7ccc8; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #efebe9; --card-accent-dim: rgba(255,255,255,0.2); }

    /* 64. Film Noir (é»‘è‰²é›»å½±) - é«˜å°æ¯” */
    .theme-64 { --card-bg: radial-gradient(circle, #444, #000); --card-border: #fff; --card-accent: #eee; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #aaa; --card-accent-dim: rgba(255,255,255,0.1); }

    /* 65. Ukiyo-e (æµ®ä¸–ç¹ª) - æµªèŠ±è— */
    .theme-65 { --card-bg: linear-gradient(to bottom, #2b5876, #4e4376); --card-border: #ffccbc; --card-accent: #ffab91; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #b39ddb; --card-accent-dim: rgba(255, 171, 145, 0.2); }

    /* 66. Art Deco (è£é£¾è—è¡“) - è“‹èŒ¨æ¯”é‡‘é»‘ */
    .theme-66 { --card-bg: #1c1c1c; --card-border: #d4af37; --card-accent: #f1c40f; --card-highlight: #fff; --card-text: #d4af37; --card-text-dim: #8e7d48; --card-accent-dim: rgba(212, 175, 55, 0.15); border-width: 2px; }

    /* 67. Bauhaus (åŒ…æµ©æ–¯) - å¹¾ä½•åŸè‰² */
    .theme-67 { --card-bg: #f0f0f0; --card-border: #d32f2f; --card-accent: #1976d2; --card-highlight: #ffeb3b; --card-text: #212121; --card-text-dim: #757575; --card-accent-dim: rgba(25, 118, 210, 0.1); }

    /* 68. Vaporwave (è’¸æ±½æ³¢) - å¾©å¤æœªä¾† */
    .theme-68 { --card-bg: linear-gradient(to right, #cc2b5e, #753a88); --card-border: #00d2ff; --card-accent: #3a7bd5; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #eaafc8; --card-accent-dim: rgba(0, 210, 255, 0.2); }

    /* 69. Mosaic (é¦¬è³½å…‹) - ç•°åŸŸé¢¨æƒ… */
    .theme-69 { --card-bg: linear-gradient(45deg, #85ffbd 0%, #ffffb0 100%); --card-border: #009688; --card-accent: #00796b; --card-highlight: #fff; --card-text: #004d40; --card-text-dim: #4db6ac; --card-accent-dim: rgba(0, 121, 107, 0.1); }

    /* --- 70-79: å®‡å®™èˆ‡æ˜Ÿéš›ç³»åˆ— (Cosmic & Celestial) --- */

    /* 70. Deep Space (æ·±ç©º) - ç„¡ç›¡é»‘ */
    .theme-70 { --card-bg: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); --card-border: #3f51b5; --card-accent: #7986cb; --card-highlight: #fff; --card-text: #e8eaf6; --card-text-dim: #5c6bc0; --card-accent-dim: rgba(121, 134, 203, 0.1); }

    /* 71. Supernova (è¶…æ–°æ˜Ÿ) - çˆ†ç™¼èƒ½é‡ */
    .theme-71 { --card-bg: linear-gradient(to right, #ff512f, #dd2476); --card-border: #ffcc80; --card-accent: #ffe0b2; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #ffab91; --card-accent-dim: rgba(255, 204, 128, 0.2); }

    /* 72. Nebula Cloud (æ˜Ÿé›²åœ˜) - ç²‰ç´«è¿·å¹» */
    .theme-72 { --card-bg: linear-gradient(to bottom, #20002c, #cbb4d4); --card-border: #e1bee7; --card-accent: #fff; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #ba68c8; --card-accent-dim: rgba(225, 190, 231, 0.2); }

    /* 73. Solar Flare (å¤ªé™½è€€æ–‘) - ç‚™ç†± */
    .theme-73 { --card-bg: linear-gradient(0deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); background: linear-gradient(to bottom, #f83600 0%, #f9d423 100%); --card-border: #fff59d; --card-accent: #ffeb3b; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #fff9c4; --card-accent-dim: rgba(255, 235, 59, 0.2); }

    /* 74. Black Hole (é»‘æ´) - å¼•åŠ›é‚Šç·£ */
    .theme-74 { --card-bg: radial-gradient(circle, #000000, #434343); --card-border: #fff; --card-accent: #fff; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #666; --card-accent-dim: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); }

    /* 75. Comet Tail (å½—å°¾) - å†°è—è»Œè·¡ */
    .theme-75 { --card-bg: linear-gradient(to left, #89f7fe, #66a6ff); --card-border: #fff; --card-accent: #fff; --card-highlight: #fff; --card-text: #01579b; --card-text-dim: #0288d1; --card-accent-dim: rgba(255,255,255,0.3); }

    /* 76. Mars Dust (ç«æ˜Ÿå¡µ) - é½ç´…ç•°æ˜Ÿ */
    .theme-76 { --card-bg: linear-gradient(to bottom, #870000, #190a05); --card-border: #ff5722; --card-accent: #ffab91; --card-highlight: #fff; --card-text: #ffccbc; --card-text-dim: #bf360c; --card-accent-dim: rgba(255, 87, 34, 0.2); }

    /* 77. Starlight (æ˜Ÿå…‰) - é»é»é–ƒçˆ */
    .theme-77 { --card-bg: #0f2027; --card-border: #fff; --card-accent: #fff; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #cfd8dc; --card-accent-dim: rgba(255,255,255,0.1); box-shadow: inset 0 0 20px rgba(255,255,255,0.05); }

    /* 78. Eclipse (æ—¥è•) - å…‰ç’° */
    .theme-78 { --card-bg: radial-gradient(circle at 50% 0, #5c5c5c, #000000); --card-border: #f5f5f5; --card-accent: #e0e0e0; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #9e9e9e; --card-accent-dim: rgba(255,255,255,0.1); }

    /* 79. Constellation (æ˜Ÿåº§) - é€£ç·š */
    .theme-79 { --card-bg: #2c3e50; --card-border: #f1c40f; --card-accent: #f39c12; --card-highlight: #fff; --card-text: #ecf0f1; --card-text-dim: #95a5a6; --card-accent-dim: rgba(241, 196, 15, 0.1); }

    /* --- 80-85: æŠ½è±¡æ¦‚å¿µç³»åˆ— (Abstract Concepts) --- */

    /* 80. Eternal Time (æ°¸æ†æ™‚é–“) - é½’è¼ªéŠ…é‡‘ */
    .theme-80 { --card-bg: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); background: linear-gradient(to right, #8e9eab, #eef2f3); --card-border: #78909c; --card-accent: #546e7a; --card-highlight: #fff; --card-text: #263238; --card-text-dim: #607d8b; --card-accent-dim: rgba(84, 110, 122, 0.1); }

    /* 81. Inner Peace (å…§å¿ƒå¹³éœ) - ç¦ªæ„ç° */
    .theme-81 { --card-bg: #d7d2cc; --card-bg: linear-gradient(to bottom, #d7d2cc, #304352); --card-border: #90a4ae; --card-accent: #cfd8dc; --card-highlight: #fff; --card-text: #eceff1; --card-text-dim: #b0bec5; --card-accent-dim: rgba(207, 216, 220, 0.1); }

    /* 82. Passion (ç†±æƒ…) - é­…æƒ‘æ·±ç´… */
    .theme-82 { --card-bg: linear-gradient(147deg, #f71735 0%, #db3445 74%); --card-border: #ff8a80; --card-accent: #ffcdd2; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #ef9a9a; --card-accent-dim: rgba(255, 205, 210, 0.2); }

    /* 83. Wisdom (æ™ºæ…§) - é›è—æ·±æ²ˆ */
    .theme-83 { --card-bg: linear-gradient(to right, #243949 0%, #517fa4 100%); --card-border: #b3e5fc; --card-accent: #81d4fa; --card-highlight: #fff; --card-text: #e1f5fe; --card-text-dim: #81d4fa; --card-accent-dim: rgba(129, 212, 250, 0.1); }

    /* 84. Balance (é™°é™½å¹³è¡¡) - é»‘ç™½å¤ªæ¥µ */
    .theme-84 { --card-bg: linear-gradient(90deg, #111 50%, #eee 50%); --card-border: #888; --card-accent: #888; --card-highlight: #f00; --card-text: #888; --card-text-dim: #aaa; --card-accent-dim: rgba(136, 136, 136, 0.2); }

    /* 85. The Singularity (å¥‡é») - çµ‚æ¥µè™¹å…‰ */
    .theme-85 { --card-bg: linear-gradient(43deg, #4158D0 0%, #C850C0 46%, #FFCC70 100%); --card-border: #fff; --card-accent: #fff; --card-highlight: #fff; --card-text: #fff; --card-text-dim: #ffe0b2; --card-accent-dim: rgba(255, 255, 255, 0.3); }
 
    /* --- THE BIG 3: éš±è—æ¬¾ (Blind Box Rares) --- */

    /* 86. Kingâ€™s Gold (SSR) */
    .theme-86 { 
      --card-bg: radial-gradient(circle at 30% 30%, #3b2b0a, #0f0b02); 
      --card-border: #ffd700; 
      --card-accent: #ffd700; 
      --card-highlight: #fff; 
      --card-text: #fff7d6; 
      --card-text-dim: rgba(255,247,214,0.9); 
      --card-accent-dim: rgba(255, 215, 0, 0.25);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.6);
      animation: goldShine 2.5s infinite alternate;
      border-width: 3px;
      border-style: solid;
    }

    /* 87. Cosmic Aurora (UR) */
    .theme-87 { 
      --card-bg: radial-gradient(circle at 50% 50%, #2b1055, #7597de); 
      --card-border: rgba(255,255,255,0.5); 
      --card-accent: #fff; 
      --card-highlight: #fff; 
      --card-text: #fff; 
      --card-text-dim: rgba(255,255,255,0.9); 
      --card-accent-dim: rgba(255,255,255,0.25);
      box-shadow: 0 0 25px rgba(118, 224, 255, 0.6);
      animation: holoPulse 3s infinite alternate;
      border-width: 3px;
      border-style: double;
    }

    /* 88. Singularity Void (SP) */
    .theme-88 {
      --card-bg: #000;
      --card-border: #0ff;
      --card-accent: #0ff;
      --card-highlight: #f0f;
      --card-text: #fff;
      --card-text-dim: #d6ffff;
      --card-accent-dim: rgba(0, 255, 255, 0.3);
      background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 400% 400%;
      animation: rainbowGlitch 3s ease infinite;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
      border: 2px solid #fff;
    }

    @keyframes goldShine { 0% { filter: brightness(1); } 50% { filter: brightness(1.18); } 100% { filter: brightness(1); } }
    @keyframes holoPulse { 0% { box-shadow: 0 0 20px rgba(118, 224, 255, 0.4); border-color: #81ecec; } 100% { box-shadow: 0 0 40px rgba(253, 121, 168, 0.6); border-color: #fd79a8; } }
    @keyframes rainbowGlitch {
      0% { background-position: 0% 50%; filter: hue-rotate(0deg); }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; filter: hue-rotate(360deg); }
    }

    footer{
      margin-top:3rem; padding:2rem; text-align:center; font-size:.85rem;
      color:var(--text-light); opacity:.75;
    }
  </style>
</head>

<body>
  <!-- Intro / Login -->
  <div id="intro-overlay">
    <h1>MOON BASE</h1>
    <div style="display:flex; gap:10px;">
      <button id="google-login-btn" class="primary-btn">Login with Google</button>
      <button onclick="showAuthForm()" class="primary-btn" style="background:var(--accent-2)">Email Login</button>
    </div>

    <div id="auth-form-container" style="display:none; margin-top:1rem; width:280px;">
      <input id="email-input" placeholder="email" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border); margin-bottom:8px; background:#0d111a; color:var(--text);"/>
      <input id="pass-input" placeholder="password" type="password" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border); margin-bottom:8px; background:#0d111a; color:var(--text);"/>
      <div style="display:flex; gap:8px;">
        <button id="email-login-btn" class="primary-btn" style="flex:1;">Login / Sign up</button>
        <button onclick="hideAuthForm()" class="primary-btn" style="flex:1; background:#64748b;">Back</button>
      </div>
    </div>

    <div id="in-app-browser-warning" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:9999; align-items:center; justify-content:center; color:white; padding:2rem; text-align:center;">
      <div>
        <h2>âš ï¸ Please open in external browser</h2>
        <p>This login doesnâ€™t work inside in-app browsers.</p>
        <button onclick="document.getElementById('in-app-browser-warning').style.display='none'" class="primary-btn">OK</button>
      </div>
    </div>
  </div>

  <header>
    <div class="logo">Teacher Shirley | Moon Base</div>
    <div class="right">
      <div id="greeting-name" style="font-weight:700; color:var(--text-light);"></div>
      <button onclick="openMemberTerminal()" class="primary-btn" style="padding:.55rem .9rem;">Member Terminal</button>
      <button id="logoutBtn" class="primary-btn" style="background:#ef4444;">Logout</button>
    </div>
  </header>

  <!-- Visitor view -->
  <section id="visitor-view" class="active">
    <div class="categories">
      <a class="category-card" href="javascript:void(0)">
        <div class="icon">ğŸŒ•</div>
        <div style="font-weight:800;">Login to Check-in</div>
        <div style="color:var(--text-light); font-size:.9rem;">Collect a card everyday</div>
      </a>
    </div>
  </section>

  <!-- Universe view -->
  <section id="universe-view">
    <div class="categories">
      <a class="category-card" href="javascript:visitPlanet('Vocabulary','./vocab.html')">
        <div class="icon">ğŸ“˜</div>
        <div style="font-weight:800;">Vocabulary Base</div>
        <div style="color:var(--text-light); font-size:.9rem;">Word of the Day</div>
      </a>
      <a class="category-card" href="javascript:visitPlanet('Quotes','./quotes.html')">
        <div class="icon">âœ¨</div>
        <div style="font-weight:800;">Quotes Base</div>
        <div style="color:var(--text-light); font-size:.9rem;">Quote of the Day</div>
      </a>
      <a class="category-card" href="javascript:openMemberTerminal()">
        <div class="icon">ğŸ§‘â€ğŸš€</div>
        <div style="font-weight:800;">Member Terminal</div>
        <div style="color:var(--text-light); font-size:.9rem;">Check-in & Card Pocket</div>
      </a>
    </div>
  </section>

  <!-- Member Terminal -->
  <div id="member-terminal">
    <div class="close-terminal" onclick="closeMemberTerminal()">âœ•</div>

    <div class="member-dashboard">
      <div class="profile-panel">
        <div class="streak-ring">
          <div class="streak-num" id="streak-days">0</div>
          <div style="font-size:.8rem; color:var(--text-light)">Streak Days</div>
        </div>

        <div style="font-size:1rem; font-weight:800;">Total Check-ins</div>
        <div style="font-size:2rem; font-weight:900; margin:.25rem 0;" id="total-days">0</div>

        <button id="checkin-btn" class="checkin-btn" onclick="handleCheckIn()">Daily Check-in</button>
        <div style="margin-top:1rem; cursor:pointer; text-decoration:underline; font-size:.85rem; color:var(--text-light);" onclick="openPrintSelection()">ğŸ–¨ï¸ Print Learning Log</div>

        <div class="calendar-wrap">
          <div class="calendar-header">
            <button onclick="prevMonth()">â—€</button>
            <div id="calendar-title" style="font-weight:800;"></div>
            <button onclick="nextMonth()">â–¶</button>
          </div>
          <div class="calendar-grid" id="calendar-grid"></div>
        </div>
      </div>

      <div class="content-panel">
        <div class="data-card word-card">
          <div style="font-size:.75rem; text-transform:uppercase; color:var(--text-light); letter-spacing:1px;">
            Word of the Day <span id="word-date"></span>
          </div>
          <div style="margin-top:.6rem;">
            <div id="wotd-word" style="font-size:1.6rem; font-weight:900;"></div>
            <div id="wotd-ipa" style="color:var(--text-light); margin:.25rem 0;"></div>
            <div><b id="wotd-pos"></b> â€” <span id="wotd-meaning"></span></div>
            <div style="margin-top:.5rem; font-style:italic;" id="wotd-sentence-e"></div>
            <div style="color:var(--text-light);" id="wotd-sentence-c"></div>
          </div>
        </div>

        <div class="data-card quote-card">
          <div style="font-size:.75rem; text-transform:uppercase; color:var(--text-light); letter-spacing:1px;">
            Quote of the Day
          </div>
          <div style="margin-top:.6rem;">
            <div id="qotd-text" style="font-size:1.15rem; font-style:italic;"></div>
            <div id="qotd-trans" style="margin-top:.5rem;"></div>
            <div id="qotd-author" style="margin-top:.5rem; text-align:right; color:var(--text-light);"></div>
          </div>
        </div>

        <!-- Card Pocket / Bag -->
        <div class="data-card pocket-section" style="margin-top:1rem;">
          <div class="pocket-title">ğŸƒ Card Pocket / å¡è¢‹</div>
          <div id="card-pocket"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Card Modal -->
  <div id="card-modal">
    <div class="card-modal-content">
      <div id="collectible-card" class="collectible-card theme-1">
        <div class="card-header">
          <div>
            <div class="card-user" id="card-user-name">Traveler</div>
            <div class="card-date" id="card-display-date">2025-01-01</div>
          </div>
          <div style="text-align:right;">
            <div class="card-serial">No. <span id="card-date-serial"></span></div>
          </div>
        </div>

        <div class="card-body">
          <div>
            <div class="card-wotd" id="card-wotd">Mystery</div>
            <div class="card-pos" id="card-pos">n.</div>
            <div class="card-def" id="card-def">To explore the unknown.</div>
          </div>

          <div class="card-sentence-container">
            <div class="card-sent-en" id="card-sent-en">Keep looking up.</div>
            <div class="card-sent-cn" id="card-sent-cn">ä¿æŒä»°æœ›æ˜Ÿç©ºã€‚</div>
          </div>

          <div class="card-quote-box">
            <div class="card-quote-text" id="card-quote">â€œThe stars are calling.â€</div>
            <div class="card-quote-trans" id="card-quote-trans">ç¾¤æ˜Ÿåœ¨å¬å–šã€‚</div>
            <div class="card-quote-author" id="card-author">Universe</div>
          </div>
        </div>

        <div class="card-footer">
          <div class="card-streak-badge"><span>ğŸ”¥</span> Streak: <span id="card-streak">0</span></div>
          <div class="card-signature">Teacher Shirley</div>
        </div>

        <div class="card-watermark">MOON BASE</div>
        <div class="card-shine"></div>
      </div>

      <div class="card-actions">
        <button class="btn-card-action btn-download" onclick="downloadCardImage()">ğŸ“¥ Download Image (æ”¶è—)</button>
        <button class="btn-card-action btn-close" onclick="closeCardModal()">âœ• Close (æ”¾å…¥å¡è¢‹)</button>
      </div>
    </div>
  </div>

  <!-- Print modal / area (left as your original behavior) -->
  <div id="print-selection-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:6000; justify-content:center; align-items:center;">
    <div class="print-modal-content" style="background:white; width:90%; max-width:700px; border-radius:12px; padding:25px; display:flex; flex-direction:column; max-height:90vh; color:#333;">
      <div class="print-modal-header" style="font-family:'Cinzel Decorative'; font-size:1.5rem; color:#2c3e50; border-bottom:2px solid var(--accent); padding-bottom:10px; margin-bottom:15px; text-align:center;">
        Select Records to Print
      </div>
      <div class="print-controls" style="display:flex; justify-content:space-between; margin-bottom:10px; background:#f8f9fa; padding:10px; border-radius:8px;">
        <button onclick="toggleAllLogs(true)" style="background:none; border:none; cursor:pointer; color:var(--accent); font-weight:bold;">â˜‘ Select All</button>
        <button onclick="toggleAllLogs(false)" style="background:none; border:none; cursor:pointer; color:#7f8c8d; font-weight:bold;">â˜ Clear All</button>
      </div>
      <div class="selection-list" id="log-selection-list" style="flex-grow:1; overflow:auto; border:1px solid #ddd; border-radius:6px; padding:10px; margin-bottom:20px; max-height:400px;"></div>
      <div class="print-actions" style="display:flex; justify-content:flex-end; gap:10px;">
        <button class="action-btn btn-cancel" onclick="closePrintSelection()" style="padding:8px 14px; border-radius:8px; border:1px solid #ddd; background:#f2f2f2; cursor:pointer;">Cancel</button>
        <button class="action-btn btn-confirm" onclick="confirmPrint()" style="padding:8px 14px; border-radius:8px; border:none; background:#111827; color:white; cursor:pointer;">ğŸ–¨ï¸ Print / Save PDF</button>
      </div>
    </div>
  </div>

  <div id="print-area" class="print-only" style="display:none;">
    <div class="print-header" style="text-align:center; border-bottom:2px solid black; margin-bottom:20px; padding-bottom:10px;">
      <h1>My Learning Journey</h1>
      <p>Student: <span id="print-name"></span> | Date: <span id="print-date"></span></p>
    </div>
    <table id="print-table">
      <thead><tr><th style="width:25%">Time / Duration</th><th style="width:20%">Activity Type</th><th>Details</th></tr></thead>
      <tbody id="print-body"></tbody>
    </table>
    <div style="margin-top:20px; font-size:0.8rem; text-align:center;">
      Generated from Teacher Shirley's ET Platform
    </div>
  </div>

  <footer>
    <div>Â©ï¸ Teacher Shirleyâ€˜s ET Platform 2025</div>
    <span id="busuanzi_container_site_pv">Total Visits: <span id="busuanzi_value_site_pv"></span></span>
  </footer>

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup,
      signInWithEmailAndPassword, createUserWithEmailAndPassword,
      onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ===== Firebase config (keep your original) =====
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // ===== Global State =====
    let currentUser = null;
    let checkinHistory = [];
    let activityLog = [];
    let cardsMap = {}; // { "YYYY-MM-DD": themeId }
    let csvData = { words: [], quotes: [] };

    // For calendar
    let viewDate = new Date();

    // ===== Utils =====
    const isInApp = /Line|FB_IAB|Instagram|WebView|MicroMessenger/i.test(navigator.userAgent);

    function getLocalISODate(date = new Date()){
      const y = date.getFullYear();
      const m = String(date.getMonth()+1).padStart(2,'0');
      const d = String(date.getDate()).padStart(2,'0');
      return `${y}-${m}-${d}`;
    }
    function getTodayMMDD(){
      const now = new Date();
      return String(now.getMonth()+1).padStart(2,'0') + '-' + String(now.getDate()).padStart(2,'0');
    }

    // ===== CSV loader (same as your logic) =====
    async function loadCSVData() {
      try {
        const [resWords, resQuotes] = await Promise.all([
          fetch('https://ducj-creator.github.io/Teacher-Shirley/assets/word%20of%20the%20day.csv'),
          fetch('https://ducj-creator.github.io/Teacher-Shirley/assets/quote%20of%20the%20day.csv')
        ]);
        csvData.words = parseCSV(await resWords.text());
        csvData.quotes = parseCSV(await resQuotes.text());
      } catch (e) {
        console.log("CSV load failed", e);
      }
    }
    function parseCSV(text){
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line=>{
        const row = {};
        const regex = /(?:,|\n|^)("(?:(?:"")*[^"]*)*"|[^",\n]*|(?:\n|$))/g;
        const matches = []; let match;
        while ((match = regex.exec(line)) !== null) {
          if (match.index === regex.lastIndex) regex.lastIndex++;
          if (match[1] !== undefined) matches.push(match[1].replace(/^"|"$/g,'').replace(/""/g,'"'));
        }
        headers.forEach((h,i)=>row[h] = matches[i] ? matches[i].trim() : '');
        return row;
      });
    }

    function renderDailyContent(dateStr){
      const wordObj = csvData.words.find(r => r.date === dateStr);
      if (wordObj){
        document.getElementById('wotd-word').innerText = wordObj.word;
        document.getElementById('wotd-ipa').innerText = wordObj.ipa;
        document.getElementById('wotd-pos').innerText = wordObj.pos;
        document.getElementById('wotd-meaning').innerText = wordObj.meaning;
        document.getElementById('wotd-sentence-e').innerText = wordObj['sentence e'];
        document.getElementById('wotd-sentence-c').innerText = wordObj['sentence c'];
        document.getElementById('word-date').innerText = `(${dateStr})`;
      }
      const quoteObj = csvData.quotes.find(r => r.date === dateStr);
      if (quoteObj){
        document.getElementById('qotd-text').innerText = quoteObj['quote e'];
        document.getElementById('qotd-trans').innerText = quoteObj['quote c'];
        document.getElementById('qotd-author').innerText = "â€” " + quoteObj.author;
      }
    }

    // ===== Card logic =====
    function getTemplateIdByDate(dateStr){
      if(!dateStr) return 1;

      let uid = 'visitor';
      try{ if(currentUser?.uid) uid = currentUser.uid; }catch(e){}

      const [y,m,d] = dateStr.split('-').map(n=>parseInt(n,10));
      const seedStr = `${y}${m}${d}-${uid}`;
      let hash = 0;
      for(let i=0;i<seedStr.length;i++){
        const char = seedStr.charCodeAt(i);
        hash = ((hash<<5) - hash) + char;
        hash = hash & hash;
      }
      hash = Math.abs(hash);
      const luck = hash % 100;

      if (luck === 99) return 88;      // SP 1%
      if (luck >= 97) return 87;       // UR 2%
      if (luck >= 94) return 86;       // SSR 3%
      return (hash % 85) + 1;          // Normal 94%
    }

    // light themes list: these are visually bright / pastel-ish, use darker text
    const LIGHT_THEMES = new Set([
      5,7,8,9,12,14,18,20,21,22,24,25,26,27,28,29,
      31,32,33,34,35,36,40,41,42,44,45,47,48,49,50,
      52,53,54,55,57,58,59,60,61,62,63,64,65,66,67,
      69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85
    ]);

    function applyTheme(cardEl, themeId){
      // remove previous
      for(let i=1;i<=88;i++) cardEl.classList.remove(`theme-${i}`);
      cardEl.classList.remove('light-theme');
      cardEl.classList.add(`theme-${themeId}`);

      if (LIGHT_THEMES.has(themeId)) cardEl.classList.add('light-theme');
    }

    // Always open with FIXED theme if exists
    window.openCard = (dateStr) => {
      const userName = (currentUser && (currentUser.displayName || currentUser.email.split('@')[0])) || "Traveler";

      // build data
      let wotd="Mystery", wotdPos="n.", wotdDef="To explore the unknown.";
      let quote="The stars are calling.", author="Universe";
      let sentEn="Keep looking up.", sentCn="ä¿æŒä»°æœ›æ˜Ÿç©ºã€‚";
      let quoteTrans="ç¾¤æ˜Ÿåœ¨å¬å–šã€‚";

      if(csvData?.words){
        const queryDate = dateStr.slice(5);
        const wordObj = csvData.words.find(r=>r.date===queryDate);
        const quoteObj = csvData.quotes.find(r=>r.date===queryDate);
        if(wordObj){
          wotd = wordObj.word || wotd;
          wotdPos = wordObj.pos || wotdPos;
          wotdDef = wordObj.meaning || wotdDef;
          sentEn = wordObj['sentence e'] || sentEn;
          sentCn = wordObj['sentence c'] || sentCn;
        }
        if(quoteObj){
          quote = quoteObj['quote e'] || quote;
          quoteTrans = quoteObj['quote c'] || quoteTrans;
          author = quoteObj.author || author;
        }
      }

      const streakDisplay = document.getElementById('streak-days')?.innerText || "0";

      document.getElementById('card-user-name').innerText = userName;
      document.getElementById('card-display-date').innerText = dateStr;
      document.getElementById('card-date-serial').innerText = dateStr.replace(/-/g,'');
      document.getElementById('card-wotd').innerText = wotd;
      document.getElementById('card-pos').innerText = wotdPos;
      document.getElementById('card-def').innerText = wotdDef;
      document.getElementById('card-sent-en').innerText = sentEn;
      document.getElementById('card-sent-cn').innerText = sentCn;
      document.getElementById('card-quote').innerText = `â€œ${quote}â€`;
      document.getElementById('card-quote-trans').innerText = quoteTrans;
      document.getElementById('card-author').innerText = author;
      document.getElementById('card-streak').innerText = streakDisplay;

      // ---- FIXED theme bucket ----
      let themeId = cardsMap[dateStr];
      if (!themeId){
        // fallback to cached localStorage
        const cache = JSON.parse(localStorage.getItem('cardsMap')||'{}');
        themeId = cache[dateStr];
      }
      if(!themeId){
        // first-time open (not checked-in yet)
        themeId = getTemplateIdByDate(dateStr);
      }
      const cardEl = document.getElementById('collectible-card');
      applyTheme(cardEl, themeId);

      document.getElementById('card-modal').classList.add('active');
    };

    window.closeCardModal = () => {
      document.getElementById('card-modal').classList.remove('active');
    };

    window.downloadCardImage = () => {
      const cardElement = document.getElementById('collectible-card');
      const btn = document.querySelector('.btn-download');
      const originalText = btn.innerText;
      btn.innerText = "Capturing... ğŸ“¸";

      if(typeof html2canvas==='undefined'){
        alert("Snapshot library not loaded.");
        btn.innerText = originalText; return;
      }

      html2canvas(cardElement,{scale:2, backgroundColor:null, useCORS:true})
        .then(canvas=>{
          const link=document.createElement('a');
          const dateText=document.getElementById('card-display-date').innerText;
          link.download=`Shirley_MoonBase_Card_${dateText}.png`;
          link.href=canvas.toDataURL('image/png');
          link.click();
          btn.innerText=originalText;
        }).catch(err=>{
          console.error(err); alert("Image capture failed.");
          btn.innerText=originalText;
        });
    };

    // ===== Check-in logic (FIXED card store) =====
    window.handleCheckIn = async () => {
      if(!currentUser) return;

      const fullDate = getLocalISODate();
      if(checkinHistory.includes(fullDate)) return;

      const btn = document.getElementById('checkin-btn');
      btn.disabled = true;
      btn.innerText = "Transmitting...";

      try{
        let currentStreak = parseInt(document.getElementById('streak-days').innerText) || 0;
        const lastCheckIn = checkinHistory.length>0 ? checkinHistory[checkinHistory.length-1] : null;

        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate()-1);
        const yesterdayStr = getLocalISODate(yesterday);

        currentStreak = (lastCheckIn === yesterdayStr) ? currentStreak+1 : 1;

        // ---- define today's theme ONCE ----
        const themeId = cardsMap[fullDate] || getTemplateIdByDate(fullDate);

        const userRef = doc(db,"users",currentUser.uid);
        const logEntry = { date:new Date().toISOString(), type:"Check-in", detail:"Daily Check-in" };

        // store history + streak + cardsMap
        cardsMap[fullDate] = themeId;
        await updateDoc(userRef,{
          streak: currentStreak,
          history: arrayUnion(fullDate),
          activityLogs: arrayUnion(logEntry),
          cardsMap: cardsMap
        });

        // update local states
        checkinHistory.push(fullDate);
        activityLog.push(logEntry);

        document.getElementById('streak-days').innerText = currentStreak;
        document.getElementById('total-days').innerText = checkinHistory.length;
        btn.innerText = "Moon Check-in Success! ğŸŒ•";

        // cache to localStorage
        localStorage.setItem('cardsMap', JSON.stringify(cardsMap));

        renderCalendar();
        renderCardPocket();

        setTimeout(()=>window.openCard(fullDate), 700);

      }catch(e){
        console.error(e);
        alert("Check-in failed: " + e.message);
        btn.disabled=false;
        btn.innerText="Daily Check-in";
      }
    };

    // ===== Calendar render (click opens FIXED card) =====
    function renderCalendar(){
      const title = document.getElementById('calendar-title');
      const grid = document.getElementById('calendar-grid');
      grid.innerHTML='';

      const y=viewDate.getFullYear();
      const m=viewDate.getMonth();
      title.innerText=`${y}-${String(m+1).padStart(2,'0')}`;

      const firstDay=new Date(y,m,1);
      const startWeekday=firstDay.getDay();
      const daysInMonth=new Date(y,m+1,0).getDate();
      const todayStr=getLocalISODate();

      // padding before month
      for(let i=0;i<startWeekday;i++){
        const empty=document.createElement('div');
        empty.className='calendar-day';
        empty.style.opacity=0; grid.appendChild(empty);
      }

      for(let day=1;day<=daysInMonth;day++){
        const dateStr=getLocalISODate(new Date(y,m,day));
        const dayEl=document.createElement('div');
        dayEl.className='calendar-day';
        dayEl.innerText=day;

        if(dateStr===todayStr) dayEl.classList.add('today');

        if(checkinHistory.includes(dateStr)){
          dayEl.classList.add('calendar-day-checked');
          dayEl.title='Tap to open Card Pocket';
          dayEl.onclick=()=>window.openCard(dateStr);
        }

        grid.appendChild(dayEl);
      }
    }
    window.prevMonth=()=>{ viewDate.setMonth(viewDate.getMonth()-1); renderCalendar(); };
    window.nextMonth=()=>{ viewDate.setMonth(viewDate.getMonth()+1); renderCalendar(); };

    // ===== Card Pocket render (BY MONTH) =====
    function renderCardPocket(){
      const container=document.getElementById('card-pocket');
      if(!container) return;

      if(!checkinHistory.length){
        container.innerHTML='<div style="color:var(--text-light); padding:.5rem;">No cards yet. Check-in to collect your first card!</div>';
        return;
      }

      // build month groups { "YYYY-MM": [dates...] }
      const byMonth = {};
      checkinHistory
        .slice()
        .sort()
        .forEach(dateStr=>{
          const key=dateStr.slice(0,7);
          if(!byMonth[key]) byMonth[key]=[];
          byMonth[key].push(dateStr);
        });

      // render newest month first
      const monthKeys = Object.keys(byMonth).sort((a,b)=>a<b?1:-1);

      container.innerHTML='';
      monthKeys.forEach(monthKey=>{
        const monthBox=document.createElement('div');
        monthBox.className='pocket-month';
        monthBox.innerHTML=`<h4>${monthKey}</h4>`;

        const grid=document.createElement('div');
        grid.className='pocket-grid';

        byMonth[monthKey].forEach(dateStr=>{
          const themeId = cardsMap[dateStr] || getTemplateIdByDate(dateStr);

          const item=document.createElement('div');
          item.className='pocket-item';
          item.onclick=()=>window.openCard(dateStr);

          const thumb=document.createElement('div');
          thumb.className=`thumb theme-${themeId} ${LIGHT_THEMES.has(themeId)?'light-theme':''}`;

          thumb.innerHTML=`
            <div class="thumb-glow"></div>
            <div class="thumb-day">${dateStr.slice(8)}</div>
          `;

          const meta=document.createElement('div');
          meta.className='pocket-date';
          meta.innerText=dateStr;

          item.appendChild(thumb);
          item.appendChild(meta);
          grid.appendChild(item);
        });

        monthBox.appendChild(grid);
        container.appendChild(monthBox);
      });
    }

    // ===== Activity log print (keep original spirit) =====
    let processedLogs = [];
    function processActivityLogs(logs){
      if(!logs||logs.length===0) return [];
      const sorted=[...logs].sort((a,b)=>new Date(a.date)-new Date(b.date));
      const grouped=[];
      for(let i=0;i<sorted.length;i++){
        const current=sorted[i];
        const next=sorted[i+1];
        const start=new Date(current.date);
        let end=next?new Date(next.date):new Date();
        let j=i+1;
        while(j<sorted.length && sorted[j].detail===current.detail){
          end=(j+1<sorted.length)?new Date(sorted[j+1].date):new Date();
          j++;
        }
        const minutes=Math.floor((end-start)/60000);
        grouped.push({start,end,type:current.type,detail:current.detail,durationStr:minutes<1?"< 1 min":`${minutes} mins`});
        i=j-1;
      }
      return grouped.reverse();
    }

    window.openPrintSelection=()=>{
      if(!currentUser) return;
      processedLogs=processActivityLogs(activityLog);
      const list=document.getElementById('log-selection-list');
      list.innerHTML='';
      if(!processedLogs.length){
        list.innerHTML='<div style="padding:20px; text-align:center;">No records found.</div>';
      }else{
        processedLogs.forEach((log,index)=>{
          const row=document.createElement('div');
          row.className='log-item-row';
          row.style.cssText='display:flex; align-items:center; padding:8px 5px; border-bottom:1px solid #eee;';
          row.innerHTML=`
            <input type="checkbox" class="log-checkbox" data-index="${index}" style="margin-right:8px;">
            <div style="flex:1;">
              <div style="font-weight:700;">${log.type}</div>
              <div style="font-size:.85rem; color:#666;">${log.start.toLocaleString()} â€¢ ${log.durationStr}</div>
              <div>${log.detail}</div>
            </div>
          `;
          list.appendChild(row);
        });
      }
      document.getElementById('print-selection-modal').style.display='flex';
    };

    window.closePrintSelection=()=>{ document.getElementById('print-selection-modal').style.display='none'; };

    window.toggleAllLogs=(checked)=>{
      document.querySelectorAll('.log-checkbox').forEach(cb=>cb.checked=checked);
    };

    window.confirmPrint=()=>{
      const picks=[...document.querySelectorAll('.log-checkbox')]
        .filter(cb=>cb.checked)
        .map(cb=>processedLogs[parseInt(cb.dataset.index)]);
      if(!picks.length){ alert("Please select at least one record."); return; }

      document.getElementById('print-name').innerText=currentUser.displayName || currentUser.email;
      document.getElementById('print-date').innerText=new Date().toLocaleDateString();
      const body=document.getElementById('print-body');
      body.innerHTML='';
      picks.forEach(log=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${log.start.toLocaleString()}<br><b>${log.durationStr}</b></td>
          <td>${log.type}</td>
          <td>${log.detail}</td>
        `;
        body.appendChild(tr);
      });

      const printArea=document.getElementById('print-area');
      printArea.style.display='block';
      window.print();
      printArea.style.display='none';
      closePrintSelection();
    };

    // ===== Auth / UI hooks =====
    window.showAuthForm=()=>{
      document.getElementById('auth-form-container').style.display='block';
    };
    window.hideAuthForm=()=>{
      document.getElementById('auth-form-container').style.display='none';
    };
    window.openMemberTerminal=()=>{
      document.getElementById('member-terminal').classList.add('show');
      renderCardPocket();
    };
    window.closeMemberTerminal=()=>document.getElementById('member-terminal').classList.remove('show');

    document.getElementById('google-login-btn').addEventListener('click', ()=>{
      if(isInApp){
        document.getElementById('in-app-browser-warning').style.display='flex';
        return;
      }
      signInWithPopup(auth, provider).catch(e=>alert("Login Error: "+e.message));
    });

    document.getElementById('email-login-btn').addEventListener('click', ()=>{
      const email=document.getElementById('email-input').value;
      const pass=document.getElementById('pass-input').value;
      if(!email||!pass) return alert("Please fill in fields");
      signInWithEmailAndPassword(auth,email,pass).catch(error=>{
        if(error.code==='auth/user-not-found'||error.code==='auth/invalid-credential'){
          if(confirm("Create account?")) createUserWithEmailAndPassword(auth,email,pass);
        }else alert(error.message);
      });
    });

    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      signOut(auth).then(()=>location.reload());
    });

    window.visitPlanet=(planetName,url)=>{
      if(currentUser) trackActivity("Exploration", `Departed Moon for ${planetName}`);
      setTimeout(()=>{ window.location.href=url; },300);
    };

    async function trackActivity(type, detail){
      if(!currentUser) return;
      const userRef = doc(db,"users",currentUser.uid);
      try{
        await updateDoc(userRef,{ activityLogs: arrayUnion({ date:new Date().toISOString(), type, detail }) });
      }catch(e){ console.log(e); }
    }

    async function loadUserData(uid){
      const userRef=doc(db,"users",uid);
      const docSnap=await getDoc(userRef);
      const today=getLocalISODate();

      if(docSnap.exists()){
        const data=docSnap.data();
        checkinHistory=data.history||[];
        activityLog=data.activityLogs||[];
        cardsMap=data.cardsMap||{};
        document.getElementById('total-days').innerText=checkinHistory.length;
        document.getElementById('streak-days').innerText=data.streak||0;
        const btn=document.getElementById('checkin-btn');
        if(checkinHistory.includes(today)) btn.disabled=true;

        // cache
        localStorage.setItem('cardsMap', JSON.stringify(cardsMap));
      }else{
        await setDoc(userRef,{ email:currentUser.email, history:[], streak:0, activityLogs:[], cardsMap:{} },{merge:true});
      }

      renderCalendar();
      renderCardPocket();
    }

    onAuthStateChanged(auth, async (user)=>{
      if(user){
        currentUser=user;
        document.getElementById('intro-overlay').style.display='none';
        document.getElementById('visitor-view').classList.remove('active');
        document.getElementById('universe-view').classList.add('active');
        document.getElementById('logoutBtn').style.display='flex';
        document.getElementById('greeting-name').innerText=`Welcome to Moon Base, ${user.displayName || user.email.split('@')[0]}`;

        await loadCSVData();
        await loadUserData(user.uid);
        renderDailyContent(getTodayMMDD());
        trackActivity("Login","Arrived at Moon Base");
      }
    });
  </script>
</body>
</html>
