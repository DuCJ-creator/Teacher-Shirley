<!DOCTYPE html>
<html lang="en" id="htmlRoot">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Teacher Shirley's ET Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Exo+2:wght@300;400;500&family=Noto+Serif+TC:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ™</text></svg>">
  
  <style id="themeStyles">
    :root {
      /* --- Light Mode (Morning Mist) --- */
      --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      --text-main: #2c3e50;
      --text-light: #5d6d7e;
      --card-bg: rgba(255, 255, 255, 0.85);
      --accent: #d4af37; /* Gold */
      --glass-border: rgba(255, 255, 255, 0.6);
      --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      --input-bg: rgba(255, 255, 255, 0.9);
    }

    /* --- Dark Mode (Midnight Nebula) --- */
    .dark {
      --bg-gradient: radial-gradient(circle at 50% 10%, #1a1a2e 0%, #16213e 40%, #0f3460 100%);
      --text-main: #e0e0e0;
      --text-light: #a0a0a0;
      --card-bg: rgba(20, 20, 35, 0.75);
      --accent: #ffd700; 
      --glass-border: rgba(255, 255, 255, 0.1);
      --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
      --input-bg: rgba(30, 30, 50, 0.8);
    }

    * { box-sizing: border-box; transition: background 0.5s ease, color 0.3s ease; }
    body {
      margin: 0; padding: 0;
      font-family: 'Exo 2', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      height: 100vh;
      overflow: hidden; /* Prevent scroll on main body */
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* --- Canvas Background --- */
    #bgCanvas {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 0; pointer-events: none;
    }

    /* --- Music & Theme Toggles --- */
    .top-controls {
      position: absolute; top: 20px; right: 20px; z-index: 1000;
      display: flex; gap: 15px;
    }
    .icon-btn {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 50%; width: 40px; height: 40px;
      cursor: pointer; font-size: 1.2rem;
      display: flex; align-items: center; justify-content: center;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .icon-btn:hover { transform: scale(1.1); var(--accent); }

    /* --- Intro Overlay (The Letter) --- */
    #intro-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      z-index: 2000;
      display: flex; justify-content: center; align-items: center;
      transition: opacity 0.8s ease;
    }

    /* The Envelope Container */
    .envelope-container {
      position: relative;
      width: 600px; height: 400px;
      perspective: 1000px;
      cursor: pointer;
    }
    
    /* Envelope Parts */
    .envelope {
      position: relative; width: 100%; height: 100%;
      background: #fdf5e6; /* Old paper color */
      border-radius: 5px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.4);
      transform-style: preserve-3d;
      transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; align-items: center; justify-content: center;
      z-index: 10;
    }
    .envelope::before { /* Flap */
      content:''; position: absolute; top: 0; left: 0; width: 0; height: 0;
      border-left: 300px solid transparent;
      border-right: 300px solid transparent;
      border-top: 200px solid #e6dcc3;
      transform-origin: top;
      transition: transform 0.8s 0.2s;
      z-index: 12;
    }
    .wax-seal {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4rem; color: #800000;
      z-index: 13;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      transition: opacity 0.5s;
    }

    /* Open State Animation */
    .envelope-container.open .envelope { transform: translateY(100px) scale(0.9); opacity: 0; pointer-events: none; }
    .envelope-container.open .envelope::before { transform: rotateX(180deg); }
    .envelope-container.open .wax-seal { opacity: 0; }

    /* The Letter Content */
    .letter-view {
      position: absolute; top: 50%; left: 50%;
      width: 90%; max-width: 600px;
      max-height: 85vh;
      background: #fffbf0 url('https://www.transparenttextures.com/patterns/cream-paper.png');
      transform: translate(-50%, -50%) scale(0.5);
      opacity: 0;
      border-radius: 10px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      overflow-y: auto;
      z-index: 5; /* Starts behind, moves front */
      transition: all 0.8s 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-family: 'Noto Serif TC', serif;
      border: 1px solid #e0d0b0;
    }
    .letter-view.show {
      z-index: 2001; opacity: 1; transform: translate(-50%, -50%) scale(1);
    }
    
    /* Letter Typography */
    .letter-header {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 2rem; color: #5d4037;
      text-align: center; margin-bottom: 20px;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 15px;
    }
    .letter-body { font-size: 1.1rem; line-height: 1.8; color: #4e342e; }
    .letter-p { margin-bottom: 15px; }
    .cn-text { font-size: 1rem; color: #795548; margin-top: 5px; font-weight: 500; }
    
    /* Login Form inside Letter */
    .auth-box {
      margin-top: 30px; padding-top: 20px; border-top: 1px dashed #bdc3c7;
      text-align: center;
    }
    .google-btn {
      background: white; color: #444;
      border: 1px solid #ddd; border-radius: 4px;
      padding: 10px 20px; font-family: 'Roboto', sans-serif; font-weight: 500;
      cursor: pointer; display: inline-flex; align-items: center; gap: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }
    .google-btn:hover { box-shadow: 0 4px 10px rgba(0,0,0,0.15); transform: translateY(-1px); }
    .visitor-link {
      display: block; margin-top: 15px; font-size: 0.9rem;
      color: #888; text-decoration: underline; cursor: pointer;
    }

    /* --- Main App (Solar System) --- */
    #app-container {
      opacity: 0; pointer-events: none; transition: opacity 1s;
      width: 100%; height: 100%; position: relative;
    }
    #app-container.active { opacity: 1; pointer-events: all; }

    /* Central Sun (User Profile) */
    .sun-wrapper {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 120px; height: 120px;
      border-radius: 50%;
      background: radial-gradient(circle, #f1c40f, #f39c12);
      box-shadow: 0 0 60px rgba(243, 156, 18, 0.6);
      display: flex; justify-content: center; align-items: center;
      z-index: 10;
      animation: sunPulse 4s infinite alternate;
    }
    .user-avatar { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; border: 4px solid #fff; }
    @keyframes sunPulse { from { box-shadow: 0 0 40px rgba(243,156,18,0.4); } to { box-shadow: 0 0 80px rgba(243,156,18,0.8); } }

    /* Orbit Paths */
    .orbit {
      position: absolute; top: 50%; left: 50%;
      border: 1px dashed rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    .dark .orbit { border-color: rgba(255,255,255,0.08); }

    /* Planets Common */
    .planet-link {
      text-decoration: none; position: absolute;
      display: flex; flex-direction: column; align-items: center;
      cursor: pointer;
      /* ç§»é™¤é€™è£¡çš„ transitionï¼Œå› ç‚ºå®ƒå¯èƒ½èˆ‡ hover æ•ˆæœè¡çª */
    }

    /* å…§å±¤è¦–è¦ºå…ƒç´  (Hover æ•ˆæœä½œç”¨æ–¼æ­¤) */
    .planet-visual {
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease;
      border-radius: 50%;
    }

    .planet-label {
      margin-top: 8px; font-size: 0.85rem; font-weight: 600;
      color: var(--text-light); text-shadow: 0 1px 2px rgba(0,0,0,0.2);
      opacity: 0.8; transition: opacity 0.3s;
      white-space: nowrap;
    }
    
    /* ä¿®æ”¹å¾Œçš„ Hover é‚è¼¯ï¼šåªæ”¾å¤§å…§å±¤ï¼Œä¸å½±éŸ¿å¤–å±¤å®šä½ */
    .planet-link:hover .planet-visual {
        transform: scale(1.2);
        box-shadow: 0 0 20px rgba(255,255,255,0.6); /* ç™¼å…‰æ•ˆæœ */
    }
    .planet-link:hover .planet-label { opacity: 1; color: var(--accent); }
    .planet-link:hover { z-index: 100; } /* ç¢ºä¿ hover æ™‚åœ¨æœ€ä¸Šå±¤ */

    /* Specific Planet Positioning (Static for now) */
    /* Mercury: Top Left */
    #mercury { width: 60px; height: 60px; transform: translate(-280px, -180px); }
    #mercury .planet-visual { width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #bdc3c7, #7f8c8d); box-shadow: inset -5px -5px 10px rgba(0,0,0,0.2); }
    
    /* Venus: Top Right */
    #venus { width: 70px; height: 70px; transform: translate(260px, -200px); }
    #venus .planet-visual { width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #e67e22, #d35400); }

    /* Earth: Bottom Left */
    #earth { width: 75px; height: 75px; transform: translate(-250px, 180px); }
    #earth .planet-visual { width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #3498db, #2980b9); }

    /* Jupiter: Far Right */
    #jupiter { width: 100px; height: 100px; transform: translate(400px, 50px); }
    #jupiter .planet-visual { width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #e1b12c, #c0392b); background-size: 200% 200%; }

    /* Saturn: Far Left (with rings) */
    #saturn { width: 90px; height: 90px; transform: translate(-420px, 0); }
    #saturn .planet-visual { width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #f1c40f, #f39c12); position: relative; }
    #saturn .planet-visual::after { /* Ring */
      content: ''; position: absolute; top: 50%; left: 50%;
      width: 140%; height: 40%;
      border: 8px solid rgba(243, 156, 18, 0.6);
      border-radius: 50%;
      transform: translate(-50%, -50%) rotate(-20deg);
    }

    /* Mars: Orbiting Animation */
    .mars-container {
      position: absolute; top: 50%; left: 50%;
      width: 500px; height: 500px; /* Orbit diameter */
      transform: translate(-50%, -50%);
      pointer-events: none; /* Let clicks pass through container */
      animation: orbitRotate 20s linear infinite;
    }
    
    /* æ»‘é¼ æ‡¸åœæ™‚æš«åœç«æ˜Ÿå…¬è½‰ï¼Œæ–¹ä¾¿é»æ“Š */
    .mars-container:hover {
        animation-play-state: paused;
    }

    .mars-wrapper {
      position: absolute; top: 0; left: 50%;
      width: 50px; height: 50px;
      transform: translate(-50%, -50%); /* Center on the orbit line */
      pointer-events: auto; /* Enable clicks on Mars */
      cursor: pointer;
    }
    .mars-visual {
        width: 100%; height: 100%;
        background: radial-gradient(circle at 30% 30%, #e74c3c, #c0392b);
        border-radius: 50%;
        transition: transform 0.3s;
    }
    .mars-wrapper:hover .mars-visual { transform: scale(1.3); box-shadow: 0 0 15px #e74c3c; }

    @keyframes orbitRotate { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }

    /* Visitor Mode */
    #visitor-view { display: none; text-align: center; width: 100%; padding-top: 50px; }
    #visitor-view.active { display: block; }
    .resource-grid {
      display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 30px;
    }
    .res-card {
      width: 200px; padding: 20px;
      background: var(--card-bg); border: 1px solid var(--glass-border);
      border-radius: 15px; backdrop-filter: blur(5px);
      text-decoration: none; color: var(--text-main);
      transition: transform 0.3s;
    }
    .res-card:hover { transform: translateY(-5px); border-color: var(--accent); }

    /* æ–°å¢ï¼šé‡é»æ–‡å­—çš„æ³¢æµªæ¡†æ¨£å¼ */
    .highlight-box {
        display: inline-block;
        font-weight: 900; /* é»‘é«” */
        font-style: italic; /* æ–œé«” */
        color: #5d4037;
        border: 2px solid var(--accent); /* æ¡†ç·šé¡è‰² */
        border-radius: 8px; /* åœ“è§’ */
        padding: 8px 12px;
        margin: 5px 0;
        background: rgba(255, 255, 255, 0.6);
        box-shadow: 3px 3px 0px rgba(184, 134, 11, 0.2);
        text-decoration: underline; /* é—œéµå­—åº•ç·š */
        text-decoration-style: wavy; /* æ³¢æµªç·š */
        text-decoration-thickness: 1.5px;
        line-height: 1.6;
    }

    /* é‡å°æ¡†å…§çš„é—œéµå­—ç‰¹åˆ¥å¼·åŒ– */
    .highlight-box .key-term {
        color: #c0392b; /* å¼·èª¿è‰² */
        text-decoration: none; 
        border-bottom: 2px solid #c0392b; /* é—œéµå­—å°ˆå±¬åº•ç·š */
    }

  </style>
</head>
<body>

  <canvas id="bgCanvas"></canvas>

  <div class="top-controls">
    <div class="icon-btn" id="themeToggle" title="Toggle Theme">ğŸŒ“</div>
    <div class="icon-btn" id="musicToggle" title="Play Music">ğŸµ</div>
  </div>
  <audio id="themeSong" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-stars-in-the-night-1070.mp3" type="audio/mp3">
  </audio>

  <div id="intro-overlay">
    <div class="envelope-container" onclick="openLetter(this)">
      <div class="envelope">
        <div class="wax-seal">ğŸŒ‘</div>
      </div>
      
      <div class="letter-view" id="letter-view" onclick="event.stopPropagation()">
        <div class="letter-header">Message from Teacher Shirley</div>
        <div class="letter-body">
          <div class="letter-p">
            <strong>Welcome, Traveler!</strong>
            <br>
            <span class="cn-text">æ­¡è¿ä¾†åˆ°é›ªè‰è€å¸«çš„è‹±èªå®‡å®™ï¼</span>
          </div>
          
          <div class="letter-p">
            Before you embark on this journey, I invite you to join our crew.
            <div class="cn-text">åœ¨å•Ÿç¨‹ä¹‹å‰ï¼Œèª æ‘¯é‚€è«‹æ‚¨æˆç‚ºæˆ‘å€‘çš„èˆ¹å“¡ã€‚</div>
          </div>

          <div class="letter-p" style="background:rgba(212, 175, 55, 0.1); padding:15px; border-radius:10px; margin-top:10px;">
            If you log in, each day youâ€™ll receive: âœ¨â€œWord of the Dayâ€, â€œBilingual Quoteâ€, and unlock your 
            <br>
            <span class="highlight-box">Shirley's Moon Base Card</span> 
            <br>
            to <span style="text-decoration:underline;">track daily check-ins</span>, <span style="text-decoration:underline;">build streaks</span>, and map your journey.
            
            <div class="cn-text" style="color:#5d4037; margin-top:8px; line-height:1.8;">
                è‹¥æ‚¨é¸æ“‡ç™»å…¥ï¼Œæ¯å¤©èƒ½ç²å¾—âœ¨ã€Œæ¯æ—¥å–®å­—ã€èˆ‡ã€Œæ¯æ—¥ä½³å¥ã€ï¼Œæ›´å¯å•Ÿç”¨ 
                <span class="highlight-box">
                    <span class="key-term">Shirley è€å¸«å°ˆå±¬çš„ã€ŒæœˆçƒåŸºåœ°å¡ã€</span>
                </span>
                â€”â€”<span style="border-bottom:1px solid #5d4037;">è¨˜éŒ„æ‰“å¡</span>ã€<span style="border-bottom:1px solid #5d4037;">ç´¯ç©å¤©æ•¸</span>èˆ‡<span style="border-bottom:1px solid #5d4037;">æ¢ç´¢è»Œè·¡</span>ã€‚
            </div>
          </div>

          <div class="auth-box">
            <button class="google-btn" onclick="handleGoogleLogin()">
              <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="G">
              Sign in with Google
            </button>
            <a class="visitor-link" onclick="enterVisitorMode()">
              Just looking around (Visitor Mode) &rarr;
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="app-container">
    
    <div id="visitor-view">
        <div style="text-align:center; margin-bottom:2rem; color:var(--text-light); background: rgba(255,255,255,0.5); padding: 10px; border-radius: 20px; display: inline-block;">
            Currently in <strong>Visitor Mode</strong>. 
            <button onclick="reopenAuth()" style="margin-left: 10px; background: var(--accent); color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; font-family: 'Exo 2';">
                Log in? ğŸš€
            </button>
        </div>

        <h1>Visitor Resources</h1>
        <div class="resource-grid">
            <a href="#" class="res-card">ğŸ“‚ Public Drive Folder</a>
            <a href="#" class="res-card">ğŸ“¹ Demo Videos</a>
            <a href="#" class="res-card">ğŸ“ About Shirley</a>
        </div>
    </div>

    <div id="user-view" style="display:none; width:100%; height:100%;">
        
        <div class="orbit" style="width:300px; height:300px;"></div>
        <div class="orbit" style="width:500px; height:500px;"></div>
        <div class="orbit" style="width:800px; height:800px;"></div>

        <div class="sun-wrapper">
            <img id="userAvatar" class="user-avatar" src="" alt="User">
        </div>

        <a href="https://calendar.google.com" target="_blank" id="mercury" class="planet-link static-planet-wrapper">
            <div class="planet-visual"></div>
            <span class="planet-label">Schedule</span>
        </a>

        <a href="https://classroom.google.com" target="_blank" id="venus" class="planet-link static-planet-wrapper">
            <div class="planet-visual"></div>
            <span class="planet-label">Classroom</span>
        </a>

        <a href="https://drive.google.com" target="_blank" id="earth" class="planet-link static-planet-wrapper">
            <div class="planet-visual"></div>
            <span class="planet-label">Drive</span>
        </a>

        <a href="https://meet.google.com" target="_blank" id="jupiter" class="planet-link static-planet-wrapper">
            <div class="planet-visual"></div>
            <span class="planet-label">Meet</span>
        </a>

        <a href="https://mail.google.com" target="_blank" id="saturn" class="planet-link static-planet-wrapper">
            <div class="planet-visual"></div>
            <span class="planet-label">Mail</span>
        </a>

        <div class="mars-container">
            <a href="#" class="mars-wrapper">
                <div class="mars-visual"></div>
            </a>
        </div>
        
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // TODO: Replace with your actual config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Global Access
    window.handleGoogleLogin = () => {
      signInWithPopup(auth, provider)
        .then((result) => {
          console.log("Logged in:", result.user);
          // Let onAuthStateChanged handle UI update
        }).catch((error) => {
          console.error("Login failed:", error);
          alert("Login error: " + error.message);
        });
    };

    window.enterVisitorMode = () => {
      document.getElementById('intro-overlay').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('intro-overlay').style.display = 'none';
        document.getElementById('app-container').classList.add('active');
        document.getElementById('visitor-view').classList.add('active');
        document.getElementById('user-view').style.display = 'none';
      }, 800);
    };

    // æ–°å¢ï¼šé‡æ–°é–‹å•Ÿç™»å…¥è¦–çª—çš„å‡½æ•¸
    window.reopenAuth = () => {
        const overlay = document.getElementById('intro-overlay');
        const visitorView = document.getElementById('visitor-view');
        
        // éš±è—è¨ªå®¢ä»‹é¢
        visitorView.classList.remove('active');
        
        // é¡¯ç¤º Overlay
        overlay.style.display = 'flex';
        // å¼·åˆ¶é‡ç¹ªä»¥è§¸ç™¼ transition
        void overlay.offsetWidth; 
        overlay.style.opacity = '1';
        
        // ç¢ºä¿ä¿¡ä»¶å‘ˆç¾ã€Œæ‰“é–‹ã€ç‹€æ…‹
        const container = document.querySelector('.envelope-container');
        const letterView = document.getElementById('letter-view');
        container.classList.add('open');
        letterView.classList.add('show');
    };

    // Auth State Listener
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // User logged in
        document.getElementById('intro-overlay').style.display = 'none';
        document.getElementById('app-container').classList.add('active');
        document.getElementById('visitor-view').classList.remove('active');
        document.getElementById('user-view').style.display = 'block';
        
        document.getElementById('userAvatar').src = user.photoURL;
      }
    });

    // UI Logic: Letter Opening
    window.openLetter = (el) => {
      if(!el.classList.contains('open')) {
        el.classList.add('open');
        setTimeout(() => {
          document.getElementById('letter-view').classList.add('show');
        }, 600);
      }
    };
  </script>

  <script>
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    let particlesArray;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      initParticles();
    });

    class Particle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2;
            this.speedX = (Math.random() * 0.2) - 0.1;
            this.speedY = (Math.random() * 0.2) - 0.1;
            this.opacity = Math.random() * 0.5;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            if(this.x > canvas.width) this.x = 0;
            if(this.x < 0) this.x = canvas.width;
            if(this.y > canvas.height) this.y = 0;
            if(this.y < 0) this.y = canvas.height;
        }
        draw(isDark) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = isDark ? `rgba(255, 255, 255, ${this.opacity})` 
                                   : `rgba(44, 62, 80, ${this.opacity * 0.5})`;
            ctx.fill();
        }
    }

    function initParticles() {
        particlesArray = [];
        for (let i = 0; i < 80; i++) {
            particlesArray.push(new Particle());
        }
    }

    function animateParticles() {
        requestAnimationFrame(animateParticles);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const isDark = document.getElementById('htmlRoot').classList.contains('dark');
        particlesArray.forEach(p => {
            p.update();
            p.draw(isDark);
        });
    }

    initParticles();
    animateParticles();

    // Theme & Music Logic
    const html = document.getElementById('htmlRoot');
    document.getElementById('themeToggle').addEventListener('click', () => {
        html.classList.toggle('dark');
    });

    const musicToggle = document.getElementById('musicToggle');
    const themeSong = document.getElementById('themeSong');
    let isPlaying = false;

    musicToggle.addEventListener('click', () => {
        if(!isPlaying) {
            themeSong.play().then(() => {
                isPlaying = true;
                musicToggle.style.opacity = '1';
                musicToggle.innerText = 'ğŸ”Š';
            }).catch(e => console.log("Audio autoplay blocked needs interaction"));
        } else {
            themeSong.pause();
            isPlaying = false;
            musicToggle.style.opacity = '0.7';
            musicToggle.innerText = 'ğŸµ';
        }
    });
  </script>
</body>
</html>
